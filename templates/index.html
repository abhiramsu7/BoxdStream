<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BoxdStream - Letterboxd Streaming Finder</title>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div id="loader" class="loader hidden">
  <div class="spinner"></div>
  <div class="loading-text">Connecting to the streaming multiverse...</div>
</div>

<header class="nav">
  <a href="/" class="logo">
    <span class="logo-boxd">Boxd</span><span class="logo-stream">Stream</span>
  </a>
  <div class="nav-right">
    <div class="nav-toolbar">
      <button class="theme-btn" onclick="toggleTheme()" title="Toggle Theme">ðŸŒ™</button>
    </div>
  </div>
</header>

<div class="hero-bg">
  <div class="hero">
    <h1>Turn your <span>Letterboxd</span><br>lists into <span>Weekend Plans</span>.</h1>
    <p style="color:var(--muted); max-width:500px; margin:0 auto; line-height:1.6;">
      Check where your favorite movies and shows are streaming across 50+ platforms instantly.
    </p>

    <div class="mode-toggle">
      <button class="mode-btn active" id="search-btn" onclick="switchMode('search')">Search Title</button>
      <button class="mode-btn" id="csv-btn" onclick="switchMode('csv')">Upload Watchlist</button>
    </div>

    <form class="hero-form" id="search-form" action="/" method="POST">
      <input type="hidden" name="mode" value="search">
      
      <div style="position:relative; flex:1; min-width:250px;">
        <input 
          type="text" 
          name="title" 
          class="search-input" 
          placeholder="Search for a movie or TV show..." 
          required 
          autocomplete="off" 
          id="movie-search">
        <div id="autocomplete-list" class="autocomplete-dropdown"></div>
      </div>

      <input type="hidden" name="tmdb_id" id="tmdb_id">
      <input type="hidden" name="media_type" id="media_type">

      <select name="region_code" id="region-select-search">
        <option value="IN" selected>India (IN)</option>
        <option value="US">United States (US)</option>
        <option value="GB">United Kingdom (GB)</option>
        <option value="CA">Canada (CA)</option>
        <option value="AU">Australia (AU)</option>
        <option value="BR">Brazil (BR)</option>
        <option value="FR">France (FR)</option>
        <option value="DE">Germany (DE)</option>
      </select>

      <button type="submit">Search</button>
    </form>

    <form class="hero-form hidden" id="csv-form" action="/" method="POST" enctype="multipart/form-data">
      <input type="hidden" name="mode" value="csv">
      
      <input type="file" name="file" accept=".csv" required>
      
      <select name="region_code" id="region-select-csv">
        <option value="IN" selected>India (IN)</option>
        <option value="US">United States (US)</option>
        <option value="GB">United Kingdom (GB)</option>
        <option value="CA">Canada (CA)</option>
        <option value="AU">Australia (AU)</option>
        <option value="BR">Brazil (BR)</option>
        <option value="FR">France (FR)</option>
        <option value="DE">Germany (DE)</option>
      </select>

      <button type="submit">Upload & Check</button>
    </form>

    <small class="availability-note">
      ðŸ’¡ <strong>Tip:</strong> Export your watchlist from Letterboxd (Settings > Import & Export) or search for individual titles to get started.
    </small>
  </div>
</div>

<footer class="footer">
  <p>BoxdStream â€¢ Powered by TMDB</p>
</footer>

<script src="{{ url_for('static', filename='theme.js') }}"></script>
<script>
  // === LOADING MESSAGES ===
  const messages = {
    morning: [
        "Brewing your morning coffee...",
        "Finding a movie to go with breakfast...",
        "Starting the day with some cinema...",
        "Waking up the streaming servers...",
        "Too early for drama? Checking anyway...",
        "Loading... (Don't forget your coffee)"
    ],
    evening: [
        "Skipping work to watch movies? Nice.",
        "Finding the perfect lunch break watch...",
        "Procrastinating like a pro...",
        "Beat the evening rush...",
        "Scanning 50+ platforms...",
        "Almost there... hold tight..."
    ],
    night: [
        "Sleep is for the weak. Movies are forever.",
        "Popcorn is popping... buttering the data...",
        "Finding a movie before your dinner gets cold...",
        "Revenge bedtime procrastination loading...",
        "Checking if it's too scary for 2 AM...",
        "Turning off the lights... loading the show..."
    ]
  };

  // === TIMEZONE LOGIC ===
  const regionTimezones = {
    'IN': 'Asia/Kolkata',
    'US': 'America/New_York',
    'GB': 'Europe/London',
    'CA': 'America/Toronto',
    'AU': 'Australia/Sydney',
    'BR': 'America/Sao_Paulo',
    'FR': 'Europe/Paris',
    'DE': 'Europe/Berlin'
  };

  function startLoadingText() {
    const textElement = document.querySelector('.loading-text');
    if (!textElement) return;

    const activeForm = document.querySelector('form:not(.hidden)');
    const regionSelect = activeForm ? activeForm.querySelector('select[name="region_code"]') : null;
    
    const selectedRegion = regionSelect ? regionSelect.value : 'IN';
    const timeZone = regionTimezones[selectedRegion] || 'UTC';

    const date = new Date();
    const formatter = new Intl.DateTimeFormat('en-US', {
        hour: 'numeric',
        hour12: false,
        timeZone: timeZone
    });
    
    const hour = parseInt(formatter.format(date));

    console.log(`Region: ${selectedRegion}, Timezone: ${timeZone}, Hour Detected: ${hour}`);

    let selectedMessages;
    if (hour >= 5 && hour < 12) {
        selectedMessages = messages.morning;
    } else if (hour >= 12 && hour < 20) {
        selectedMessages = messages.evening;
    } else {
        selectedMessages = messages.night;
    }

    let i = 0;
    textElement.textContent = selectedMessages[0];
    
    if (window.loadingInterval) clearInterval(window.loadingInterval);

    window.loadingInterval = setInterval(() => {
        i = (i + 1) % selectedMessages.length;
        textElement.style.opacity = 0; 
        
        setTimeout(() => {
            textElement.textContent = selectedMessages[i];
            textElement.style.opacity = 1; 
        }, 300);
        
    }, 2000); 
  }

  // Trigger on Form Submit
  document.querySelectorAll('form').forEach(form => {
    form.addEventListener('submit', function() {
      document.getElementById('loader').classList.remove('hidden');
      startLoadingText();
    });
  });
</script>

</body>
</html>