<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BoxdStream - Letterboxd Streaming Finder</title>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div id="loader" class="loader hidden">
  <div class="spinner"></div>
  <div class="loading-text">Connecting to the streaming multiverse...</div>
</div>

<header class="nav">
  <a href="/" class="logo">
    <span class="logo-boxd">Boxd</span><span class="logo-stream">Stream</span>
  </a>
  <div class="nav-right">
    <div class="nav-toolbar">
      <button class="theme-btn" onclick="toggleTheme()" title="Toggle Theme">ðŸŒ™</button>
    </div>
  </div>
</header>

<div class="hero-bg">
  <div class="hero">
    <h1>Turn your <span>Letterboxd</span><br>lists into <span>Weekend Plans</span>.</h1>
    <p style="color:var(--muted); max-width:500px; margin:0 auto; line-height:1.6;">
      Check where your favorite movies and shows are streaming across 50+ platforms instantly.
    </p>

    <form class="hero-form" id="search-form" action="/" method="POST">
      <input type="hidden" name="mode" value="search">
      
      <div style="position:relative; flex:1; min-width:250px;">
        <input type="text" name="title" class="search-input" placeholder="Search for a movie or TV show..." required autocomplete="off" id="movie-search">
        <div id="autocomplete-list" class="autocomplete-dropdown"></div>
      </div>

      <input type="hidden" name="tmdb_id" id="tmdb_id">
      <input type="hidden" name="media_type" id="media_type">

      <select name="region_code" id="region-select">
        <option value="IN" selected>India (IN)</option>
        <option value="US">United States (US)</option>
        <option value="GB">United Kingdom (GB)</option>
        <option value="CA">Canada (CA)</option>
        <option value="AU">Australia (AU)</option>
        <option value="BR">Brazil (BR)</option>
        <option value="FR">France (FR)</option>
        <option value="DE">Germany (DE)</option>
      </select>

      <button type="submit">Search</button>
    </form>

    <small class="availability-note">
      ðŸ’¡ <strong>Tip:</strong> Export your watchlist from Letterboxd (Settings > Import & Export) or search for individual titles to get started.
    </small>
  </div>
</div>

<footer class="footer">
  <p>BoxdStream â€¢ Powered by TMDB</p>
</footer>

<script src="{{ url_for('static', filename='theme.js') }}"></script>
<script>
  // === 1. DEFINE THE MESSAGES ===
  const messages = {
    morning: [ // 5 AM - 12 PM
        "Brewing your morning coffee...",
        "Finding a movie to go with breakfast...",
        "Starting the day with some cinema...",
        "Waking up the streaming servers...",
        "Too early for drama? Checking anyway...",
        "Loading... (Don't forget your coffee)"
    ],
    evening: [ // 12 PM - 8 PM (Afternoon/Evening)
        "Skipping work to watch movies? Nice.",
        "Finding the perfect lunch break watch...",
        "Procrastinating like a pro...",
        "Beat the evening rush...",
        "Scanning 50+ platforms...",
        "Almost there... hold tight..."
    ],
    night: [ // 8 PM - 5 AM
        "Sleep is for the weak. Movies are forever.",
        "Popcorn is popping... buttering the data...",
        "Finding a movie before your dinner gets cold...",
        "Revenge bedtime procrastination loading...",
        "Checking if it's too scary for 2 AM...",
        "Turning off the lights... loading the show..."
    ]
  };

  // === 2. DEFINE REGION TIMEZONES ===
  const regionTimezones = {
    'IN': 'Asia/Kolkata',
    'US': 'America/New_York', // East Coast default
    'GB': 'Europe/London',
    'CA': 'America/Toronto',  // Eastern Time default
    'AU': 'Australia/Sydney',
    'BR': 'America/Sao_Paulo',
    'FR': 'Europe/Paris',
    'DE': 'Europe/Berlin'
  };

  function startLoadingText() {
    const textElement = document.querySelector('.loading-text');
    if (!textElement) return;

    // A. Get Selected Region
    const regionSelect = document.getElementById('region-select');
    const selectedRegion = regionSelect.value;
    const timeZone = regionTimezones[selectedRegion] || 'UTC';

    // B. Get Hour in THAT Region
    const date = new Date();
    // Use Intl API to extract the hour in the specific timezone
    const formatter = new Intl.DateTimeFormat('en-US', {
        hour: 'numeric',
        hour12: false,
        timeZone: timeZone
    });
    const hour = parseInt(formatter.format(date));

    // C. Pick the Vibe
    let selectedMessages;
    if (hour >= 5 && hour < 12) {
        selectedMessages = messages.morning;
    } else if (hour >= 12 && hour < 20) {
        selectedMessages = messages.evening;
    } else {
        selectedMessages = messages.night;
    }

    // D. Start Rotation
    let i = 0;
    textElement.textContent = selectedMessages[0];
    
    setInterval(() => {
        i = (i + 1) % selectedMessages.length;
        textElement.style.opacity = 0; // Fade out
        
        setTimeout(() => {
            textElement.textContent = selectedMessages[i];
            textElement.style.opacity = 1; // Fade in
        }, 300);
        
    }, 2000); 
  }

  // Trigger on Form Submit
  document.querySelectorAll('form').forEach(form => {
    form.addEventListener('submit', function() {
      document.getElementById('loader').classList.remove('hidden');
      startLoadingText();
    });
  });

  // === AUTOCOMPLETE LOGIC (No Changes Needed Here) ===
  const searchInput = document.getElementById('movie-search');
  const autocompleteList = document.getElementById('autocomplete-list');
  let debounceTimer;

  searchInput.addEventListener('input', function() {
    clearTimeout(debounceTimer);
    const query = this.value;
    
    if (query.length < 3) {
      autocompleteList.innerHTML = '';
      return;
    }

    debounceTimer = setTimeout(() => {
      fetch(`https://api.themoviedb.org/3/search/multi?api_key=5b421e05cad15891667ec28db3d9b9ac&query=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(data => {
          autocompleteList.innerHTML = '';
          const results = data.results.filter(item => item.media_type === 'movie' || item.media_type === 'tv').slice(0, 5);
          
          results.forEach(item => {
            const div = document.createElement('div');
            div.className = 'autocomplete-item';
            const title = item.title || item.name;
            const year = (item.release_date || item.first_air_date || '').split('-')[0];
            const typeBadge = item.media_type === 'movie' ? '<span class="type-badge badge-movie">MOVIE</span>' : '<span class="type-badge badge-tv">TV</span>';
            
            div.innerHTML = `<strong>${title}</strong> <span style="color:var(--muted); font-size:0.85rem">(${year})</span> ${typeBadge}`;
            
            div.addEventListener('click', function() {
              searchInput.value = title;
              document.getElementById('tmdb_id').value = item.id;
              document.getElementById('media_type').value = item.media_type;
              autocompleteList.innerHTML = '';
            });
            
            autocompleteList.appendChild(div);
          });
        });
    }, 300);
  });

  document.addEventListener('click', function(e) {
    if (e.target !== searchInput) {
      autocompleteList.innerHTML = '';
    }
  });
</script>

</body>
</html>