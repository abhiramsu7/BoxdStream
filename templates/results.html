<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BoxdStream Results</title>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<header class="nav">
  <a href="/" class="logo">
    <span class="logo-boxd">Boxd</span><span class="logo-stream">Stream</span>
  </a>
  
  <div class="nav-right">
    <div class="nav-toolbar">
      <button class="icon-btn" onclick="window.history.back()" title="Go Back">â†</button>
      <button class="icon-btn" onclick="window.history.forward()" title="Go Forward">â†’</button>
      <div class="separator"></div>
      <a href="/" class="icon-btn" title="Home / New Search">ğŸ </a>
      <div class="separator"></div>
      <button class="theme-btn" onclick="toggleTheme()" title="Toggle Theme">ğŸŒ™</button>
    </div>
  </div>
</header>

<section class="summary">
  <div>
    <strong>{{ summary.available_free }}</strong>
    <span>Free to Watch</span>
  </div>
  <div>
    <strong>{{ summary.rent_or_buy }}</strong>
    <span>Rent / Buy</span>
  </div>
  <div>
    <strong>{{ summary.unreleased }}</strong>
    <span>Coming Soon</span>
  </div>
</section>

<div class="filter-bar-container">
  <div class="filter-bar">
    <button class="filter-btn active" onclick="filterMovies('all', this)">All</button>
    <button class="filter-btn" onclick="filterMovies('Netflix', this)">Netflix</button>
    <button class="filter-btn" onclick="filterMovies('Prime', this)">Prime Video</button>
    <button class="filter-btn" onclick="filterMovies('Disney', this)">Disney+</button>
    <button class="filter-btn" onclick="filterMovies('Apple', this)">Apple TV</button>
    <button class="filter-btn" onclick="filterMovies('Jio', this)">JioCinema</button>
    <button class="filter-btn" onclick="filterMovies('Rent', this)">Rent/Buy</button>
  </div>
</div>

<section class="grid {% if results|length == 1 %}single-result{% endif %}">
{% for movie in results %}
  <div class="card {{ movie.ui_class }}">

    {% if movie.poster %}
      <img src="{{ movie.poster }}" alt="{{ movie.title }} poster" class="poster" loading="lazy">
    {% else %}
      <div class="poster placeholder"><span>No Poster</span></div>
    {% endif %}

    <h3>{{ movie.title }}</h3>
    <div class="year">{{ movie.year }}</div>
    <div class="card-status">{{ movie.status }}</div>
    
    {% if results|length == 1 %}
    <div class="quick-actions">
      <p style="font-size:0.85rem;color:var(--muted);margin:0 0 12px 0;font-weight:600;">ğŸ” Search Elsewhere:</p>
      <div>
        <a href="https://www.google.com/search?q={{ movie.title }}+{{ movie.year }}+watch+online" target="_blank" class="quick-link">Google</a>
        <a href="https://www.justwatch.com/in/search?q={{ movie.title }}" target="_blank" class="quick-link">JustWatch</a>
      </div>
    </div>
    {% endif %}

  </div>
{% endfor %}
</section>

<button class="scroll-top" id="scrollTopBtn" onclick="scrollToTop()">â†‘</button>

<footer class="footer">
  <p>BoxdStream â€¢ Powered by TMDB</p>
</footer>

<script src="{{ url_for('static', filename='theme.js') }}"></script>
<script>
  // SCROLL TOP LOGIC
  window.addEventListener('scroll', function() {
    const btn = document.getElementById('scrollTopBtn');
    if (window.pageYOffset > 300) {
      btn.classList.add('visible');
    } else {
      btn.classList.remove('visible');
    }
  });

  function scrollToTop() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  // FILTER LOGIC
  function filterMovies(filter, btn) {
    // 1. Update active button style
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    // 2. Filter cards
    const cards = document.querySelectorAll('.card');
    
    cards.forEach(card => {
      if (filter === 'all') {
        card.classList.remove('hidden');
      } else {
        const statusText = card.querySelector('.card-status').textContent;
        // Check if the status text contains the filter (case insensitive)
        if (statusText.toLowerCase().includes(filter.toLowerCase())) {
          card.classList.remove('hidden');
        } else {
          card.classList.add('hidden');
        }
      }
    });
  }
</script>

</body>
</html>