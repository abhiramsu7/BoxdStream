<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BoxdStream Results</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Vercel Web Analytics -->
    <script>
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
    <style>
        /* === NEW: CLOSURE BANNER (Top of Page) === */
        .closure-banner {
            text-align: center;
            padding: 30px 20px 10px; /* Spacing above summary */
            animation: fadeIn 0.8s ease-out;
        }

        .closure-text {
            font-size: 1.4rem; /* Prominent size */
            font-weight: 700;
            color: var(--text-primary, #e0e0e0);
            letter-spacing: -0.5px;
            margin: 0;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        /* Heart Animation */
        .heart {
            display: inline-block;
            color: #e50914;
            animation: heartbeat 1.5s infinite ease-in-out;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* === FOOTER (Minimal) === */
        .footer {
            margin-top: 60px;
            padding: 30px 20px;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(0, 0, 0, 0.2);
        }

        .attribution {
            font-size: 0.8rem;
            color: var(--text-secondary, rgba(255, 255, 255, 0.4));
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        .attribution span {
            font-weight: 700;
            color: var(--text-primary, #fff);
            opacity: 0.8;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<header class="nav">
    <a href="/" class="logo">
        <span class="logo-boxd">Boxd</span><span class="logo-stream">Stream</span>
    </a>
    <div class="nav-right">
        <div class="nav-toolbar">
            <a href="/" class="icon-btn" title="New Search / Back">‚Üê</a>
            <div class="separator"></div>
            <button class="theme-btn" onclick="toggleTheme()" title="Toggle Theme">üåô</button>
        </div>
    </div>
</header>

<div class="closure-banner">
    <p class="closure-text">
        Watchlists deserve closure <span class="heart">‚ù§Ô∏è</span>
    </p>
</div>

<section class="summary">
    <div onclick="filterMovies('free', null)" style="cursor:pointer" title="Click to see Free movies">
        <strong>{{ summary.available_free }}</strong><span>Free to Watch</span>
    </div>
    <div onclick="filterMovies('Rent', null)" style="cursor:pointer" title="Click to see Rent/Buy movies">
        <strong>{{ summary.rent_or_buy }}</strong><span>Rent / Buy</span>
    </div>
    <div onclick="filterMovies('unavailable', null)" style="cursor:pointer" title="Click to see Not Streaming movies">
        <strong>{{ summary.not_streaming }}</strong><span>Not Streaming</span>
    </div>
    <div onclick="filterMovies('unreleased', null)" style="cursor:pointer" title="Click to see Coming Soon">
        <strong>{{ summary.unreleased }}</strong><span>Coming Soon</span>
    </div>
</section>

<div class="filter-bar-container">
    <div class="filter-bar">
        <button class="filter-btn active" onclick="filterMovies('all', this)">All</button>
        <button class="filter-btn" onclick="filterMovies('Netflix', this)">Netflix</button>
        <button class="filter-btn" onclick="filterMovies('Prime', this)">Prime Video</button>
        <button class="filter-btn" onclick="filterMovies('Apple', this)">Apple TV</button>

        {% if region == 'IN' %}
            <button class="filter-btn" onclick="filterMovies('JioHotstar', this)">JioHotstar</button>
            <button class="filter-btn" onclick="filterMovies('Zee5', this)">ZEE5</button>
            <button class="filter-btn" onclick="filterMovies('Sony', this)">SonyLIV</button>
            <button class="filter-btn" onclick="filterMovies('Aha', this)">Aha</button>
        {% endif %}
        
        {% if region != 'IN' %}
            <button class="filter-btn" onclick="filterMovies('Disney', this)">Disney+</button>
            <button class="filter-btn" onclick="filterMovies('Hulu', this)">Hulu</button>
        {% endif %}

        <button class="filter-btn" onclick="filterMovies('Rent', this)">Rent/Buy</button>
    </div>
</div>

<section class="grid {% if results|length == 1 %}single-result{% endif %}">
{% for movie in results %}
    <div class="card {{ movie.ui_class }}" 
         data-status="{{ 'free' if movie.ui_class == 'streaming' else 'other' }}"
         data-specific-status="{{ movie.status }}"> 
        {% if movie.poster %}
            <img src="{{ movie.poster }}" alt="{{ movie.title }}" class="poster" loading="lazy">
        {% else %}
            <div class="poster placeholder"><span>No Poster</span></div>
        {% endif %}

        <h3>{{ movie.title }}</h3>
        <div class="year">{{ movie.year }}</div>

        <div class="card-status">
            {% if movie.providers %}
                <div class="provider-grid">
                {% for p in movie.providers %}
                    <a href="{{ p.link }}" target="_blank" class="provider-icon" title="Watch on {{ p.name }}" data-name="{{ p.name }}" data-label="{{ p.label }}">
                        {% if p.logo %}
                            <img src="{{ p.logo }}" alt="{{ p.name }}">
                        {% else %}
                            <span>{{ p.name[:3] }}</span>
                        {% endif %}
                        {% if p.label != 'Subscription' %}
                            <span class="mini-tag">{{ p.label }}</span>
                        {% endif %}
                    </a>
                {% endfor %}
                </div>
            {% else %}
                <span class="static-status">{{ movie.status }}</span>
            {% endif %}
        </div>
    </div>
{% endfor %}
</section>

<div id="empty-state" class="empty-state hidden">
    <div class="empty-icon" id="empty-emoji">üëª</div>
    <h3 id="empty-title">It's a ghost town here.</h3>
    <p id="empty-desc">None of your watchlist movies match this filter.</p>
    <button onclick="filterMovies('all', document.querySelector('.filter-btn'))" class="reset-btn">View All Movies</button>
</div>

<footer class="footer">
    <div class="attribution">
        <span>BoxdStream</span> ‚Ä¢ Powered by TMDB
    </div>
</footer>

<script src="{{ url_for('static', filename='theme.js') }}"></script>
<script>
    const emptyMessages = {
        'netflix': { emoji: "üì∫", title: "Tudum... Silence.", desc: "Are you still watching? Because we couldn't find any matches here." },
        'prime': { emoji: "üì¶", title: "Delivery Delayed.", desc: "Even Prime One-Day delivery couldn't find these movies." },
        'aha': { emoji: "üß°", title: "Aha! ... Em Kanipinchadam Ledu.", desc: "100% Telugu, but 0% found in this list. Try another filter!" },
        'hotstar': { emoji: "üèè", title: "Out for a Duck!", desc: "Disney magic couldn't conjure up these results." },
        'zee5': { emoji: "ü¶ì", title: "Zee-ro Results Found.", desc: "Looks like the drama is happening elsewhere." },
        'sonyliv': { emoji: "üõãÔ∏è", title: "LIV a Little...", desc: "...somewhere else. No matches found here." },
        'jio': { emoji: "üì∂", title: "Network Issue?", desc: "Just kidding, your net is fine. The movies just aren't here." },
        'apple': { emoji: "üçé", title: "Too Expensive?", desc: "Maybe these movies were too premium for this list." },
        'free': { emoji: "üí∏", title: "No Free Lunch.", desc: "All these movies require rent or aren't streaming yet." },
        'rent': { emoji: "üí≥", title: "Wallet Safe.", desc: "Nothing to rent or buy here." },
        'unreleased': { emoji: "üìÖ", title: "All Released!", desc: "Every movie in your list has already hit the screens." },
        'unavailable': { emoji: "üéâ", title: "Everything is Streaming!", desc: "Great news! All your movies are available somewhere." },
        'default': { emoji: "üëª", title: "It's a ghost town here.", desc: "None of your watchlist movies match this filter." }
    };

    function filterMovies(filter, btn) {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        if (btn) btn.classList.add('active');
        else if (filter === 'all') document.querySelector('.filter-btn').classList.add('active');

        const cards = document.querySelectorAll('.card');
        let visibleCount = 0;
        
        cards.forEach(card => {
            const badges = card.querySelectorAll('.provider-icon');
            const cardStatus = card.getAttribute('data-specific-status');
            let showCard = false;

            if (filter === 'all') {
                showCard = true;
                badges.forEach(b => b.style.display = 'block');
            } else if (filter === 'free') {
                let hasSub = false;
                badges.forEach(b => { if (b.getAttribute('data-label') === 'Subscription') hasSub = true; });
                if (hasSub) showCard = true;
                badges.forEach(b => { b.style.display = (b.getAttribute('data-label') === 'Subscription') ? 'block' : 'none'; });
            } else if (filter === 'unavailable') {
                if (cardStatus === 'Not Streaming' || cardStatus === 'Not Found') showCard = true;
            } else if (filter === 'unreleased') {
                if (cardStatus === 'Coming Soon') showCard = true;
            } else {
                let hasProviderMatch = false;
                badges.forEach(badge => {
                    const name = badge.getAttribute('data-name').toLowerCase();
                    const label = badge.getAttribute('data-label').toLowerCase();
                    const filterLower = filter.toLowerCase();
                    let isMatch = false;
                    
                    if (filter === 'JioHotstar') { if (name.includes('jio') || name.includes('hotstar') || name.includes('disney')) isMatch = true; }
                    else if (filter === 'Rent') { if (label.includes('rent') || label.includes('buy')) isMatch = true; }
                    else { if (name.includes(filterLower)) isMatch = true; }

                    if (isMatch) { badge.style.display = 'block'; hasProviderMatch = true; } 
                    else { badge.style.display = 'none'; }
                });
                if (hasProviderMatch) showCard = true;
            }

            if (showCard) { card.classList.remove('hidden'); visibleCount++; } 
            else { card.classList.add('hidden'); }
        });

        const emptyState = document.getElementById('empty-state');
        if (visibleCount === 0) {
            emptyState.classList.remove('hidden');
            let key = 'default';
            const p = filter.toLowerCase();
            for (const k in emptyMessages) { if (p.includes(k)) key = k; }
            const msg = emptyMessages[key] || emptyMessages['default'];
            document.getElementById('empty-emoji').textContent = msg.emoji;
            document.getElementById('empty-title').textContent = msg.title;
            document.getElementById('empty-desc').textContent = msg.desc;
        } else {
            emptyState.classList.add('hidden');
        }
    }
</script>
</body>
</html>